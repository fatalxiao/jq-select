!function(e){function t(t,l){function o(e){return null!==e&&void 0!==e}function c(t){return t=t||l.data,!!e.isArray(t)&&0==t.filter(function(t){return e.isPlainObject(t)}).length}function r(e){O._isLoading=e,e?T.addClass("loading"):T.removeClass("loading")}function d(i){i=i||T.find(".jq-select-popup");var n=t.offset(),a=t.height(),s=0,o=l.data;if(!l.hideFilter&&O._filterText&&(o=u()),l.group)for(var c in o)o[c].length>0&&(s+=30*(o[c].length+1));else o&&o.length>0&&(s=30*o.length);s=s>300?300:s,l.multi&&l.hideSelectAll===!1&&(s+=30),l.hideFilter===!1&&(s+=30),l.hideOKButton!==!1&&l.hideCloseButton!==!1&&l.hideClearButton!==!1||(s+=40),n.top+a+s-e(window).scrollTop()>e(window).height()?i.css("top",-s):i.css("top",a)}function u(){var t;if(l.group){t={};for(var i in l.data){var n=l.data[i].filter(function(t){return e.isPlainObject(t)?o(t)&&o(t[l.displayField])&&t[l.displayField].toString().toUpperCase().indexOf(O._filterText.toUpperCase())>-1:o(t)&&t.toString().toUpperCase().indexOf(O._filterText.toUpperCase())>-1});n.length>0&&(t[i]=n)}}else t=l.data.filter(function(t){return e.isPlainObject(t)?o(t)&&o(t[l.displayField])&&t[l.displayField].toString().toUpperCase().indexOf(O._filterText.toUpperCase())>-1:o(t)&&t.toString().toUpperCase().indexOf(O._filterText.toUpperCase())>-1});return t}function f(t){O._rendering=!0;var i=l.data,n=O._filterData||l.data,r=t&&t.scrollTop||0,d=T.find(".jq-select-list-scroller").html("");if(heightCount=0,l.group){if(e.isEmptyObject(i))return;var u=!0;for(var f in i){if(heightCount>r+l.listHeight)break;if(heightCount<=r+l.listHeight&&heightCount+l.groupTitleHeight+l.itemHeight*i[f].length>=r){var h=e(a).attr("data-name",f);if(u&&(d.append('<div style="height:'+heightCount+'px"></div>'),u=!1),heightCount+=l.groupTitleHeight,l.multi){if(O._selectedValue&&n&&O._selectedValue[f]&&n[f]){var p=0;c(n[f])?n[f].forEach(function(e){O._selectedValue[f].indexOf(e)>-1&&p++}):n[f].forEach(function(e){for(var t=0,i=O._selectedValue[f].length;t<i;t++)if(O._selectedValue[f][t][l.valueField].toString()===e[l.valueField].toString()){p++;break}}),p===n[f].length&&h.find(".jq-select-group-checkbox").prop("checked",!0)}}else h.find(".jq-select-group-checkbox").remove();h.find(".jq-select-group-title-name").html(f);for(var g=h.find(".jq-select-group-children"),v=!0,p=0,m=0,x=i[f].length;m<x;m++)if(void 0!==i[f][m]){var V=i[f][m];if(heightCount+l.itemHeight>=r&&heightCount<=r+l.listHeight){var j=e(s).attr("data-index",m);if(v&&(g.append('<div style="height:'+l.itemHeight*m+'px"></div>'),v=!1),c(i[f])){if(O._filterText&&V.toUpperCase().indexOf(O._filterText.toUpperCase())==-1)continue;l.multi?O._selectedValue[f]&&1==O._selectedValue[f].filter(function(e){return o(e)&&o(V)&&e.toString()===V.toString()}).length&&j.find(".jq-select-item-checkbox").prop("checked",!0):(j.find(".jq-select-item-checkbox").remove(),o(O._selectedValue[f])&&o(V)&&O._selectedValue[f].toString()===V.toString()&&j.addClass("activated")),j.find(".jq-select-item-name").html(V)}else{if(O._filterText&&V[l.displayField].toUpperCase().indexOf(O._filterText.toUpperCase())==-1)continue;l.multi?O._selectedValue[f]&&1==O._selectedValue[f].filter(function(e){return o(e[l.valueField])&&o(V[l.valueField])&&e[l.valueField].toString()===V[l.valueField].toString()}).length&&j.find(".jq-select-item-checkbox").prop("checked",!0):(j.find(".jq-select-item-checkbox").remove(),o(O._selectedValue[f])&&o(O._selectedValue[f][l.valueField])&&o(V)&&V[l.valueField]&&O._selectedValue[f][l.valueField].toString()===V[l.valueField].toString()&&j.addClass("activated")),V[l.iconClsField]?j.find(".jq-select-item-icon").addClass(V[l.iconClsField]):j.find(".jq-select-item-icon").remove(),j.find(".jq-select-item-name").html(V[l.displayField])}g.append(j),p++}heightCount+=l.itemHeight}p>0?d.append(h):heightCount-=l.groupTitleHeight}else{heightCount+=l.groupTitleHeight;for(var p=0,m=0,x=i[f].length;m<x;m++)if(void 0!==i[f][m]){var V=i[f][m];if(c(i[f])){if(O._filterText&&V.toUpperCase().indexOf(O._filterText.toUpperCase())==-1)continue}else if(O._filterText&&V[l.displayField].toUpperCase().indexOf(O._filterText.toUpperCase())==-1)continue;p++,heightCount+=l.itemHeight}0==p&&(heightCount-=l.groupTitleHeight)}}var S=0;for(var f in n)S+=l.groupTitleHeight+l.itemHeight*n[f].length;d.height(S)}else{if(!e.isArray(i))return;for(var C=c(i),v=!0,m=0,x=i.length;m<x;m++)if(void 0!==i[m]){if(heightCount>r+l.listHeight)break;if(heightCount+l.itemHeight>=r&&heightCount<=r+l.listHeight){var V=i[m],j=e(s).attr("data-index",m);if(v&&(heightCount>0&&d.append('<div style="height:'+heightCount+'px"></div>'),v=!1),C){if(O._filterText&&V.toString().toUpperCase().indexOf(O._filterText.toUpperCase())==-1)continue;l.multi?1==O._selectedValue.filter(function(e){return o(e)&&o(V)&&e.toString()===V.toString()}).length&&j.find(".jq-select-item-checkbox").prop("checked",!0):(j.find(".jq-select-item-checkbox").remove(),o(O._selectedValue)&&o(V)&&O._selectedValue.toString()===V.toString()&&j.addClass("activated")),j.find(".jq-select-item-name").html(V)}else{if(O._filterText&&V[l.displayField].toUpperCase().indexOf(O._filterText.toUpperCase())==-1)continue;l.multi?1==O._selectedValue.filter(function(e){return o(e[l.valueField])&&o(V[l.valueField])&&e[l.valueField].toString()===V[l.valueField].toString()}).length&&j.find(".jq-select-item-checkbox").prop("checked",!0):(j.find(".jq-select-item-checkbox").remove(),o(O._selectedValue[l.valueField])&&o(V[l.valueField])&&O._selectedValue[l.valueField].toString()===V[l.valueField].toString()&&j.addClass("activated")),j.find(".jq-select-item-name").html(V[l.displayField])}d.append(j)}heightCount+=l.itemHeight}d.height(n.length*l.itemHeight)}_(),O._rendering=!1}function h(){O._listScrollTop=0,y=e(n).css("min-width",l.triggerWidth),"auto"===l.popupWidth?y.css("width","auto"):isNaN(l.popupWidth)||y.width(l.popupWidth),l.hideFilter?y.find(".jq-select-filter").remove():y.find(".jq-select-filter").val(O._filterText),!l.multi||l.hideSelectAll?y.find(".jq-select-select-all").remove():y.find(".jq-select-select-all-name").html(l.selectAllText);var t=y.find(".jq-select-buttons"),i=y.find(".jq-select-buttons-ok"),a=y.find(".jq-select-buttons-clear"),s=y.find(".jq-select-buttons-close"),o=0;l.hideOKButton?i.remove():(i.html(l.okButtonText),o++),l.hideClearButton?a.remove():(a.html(l.clearButtonText),o++),l.hideCloseButton?s.remove():(s.html(l.closeButtonText),o++),0===o?t.remove():t.addClass("buttons-"+o),d(y),T.append(y),f(),v()}function p(){T.children(".jq-select-popup").remove()}function g(){T.find(".jq-select-filter").bind("input",function(e){O._filterText=e.target.value,O._filterData=u()||l.data,f(),d()})}function v(){T.find(".jq-select-select-all").change(function(t){if(t.stopPropagation(),!O._rendering){var i=O._filterData||l.data;if(i&&l.multi){var n=[],a=e(this).children('input[type="checkbox"]'),s=a.prop("checked");if(T.find(".jq-select-select-all-name").html(s?l.deselectAllText:l.selectAllText),l.group){i=e.extend(!0,{},i);for(var r in i)n=n.concat(i[r])}else n=e.extend(!0,[],i);if(s){if(l.group)for(var d in i)O._selectedValue[d]||(O._selectedValue[d]=[]),c(i[d])?i[d].forEach(function(e){0==O._selectedValue[d].filter(function(t){return o(e)&&o(t)&&e.toString()===t.toString()}).length&&O._selectedValue[d].push(e)}):i[d].forEach(function(e){0==O._selectedValue[d].filter(function(t){return o(e[l.valueField])&&o(t[l.valueField])&&e[l.valueField].toString()===t[l.valueField].toString()}).length&&O._selectedValue[d].push(e)});else O._selectedValue=e.extend(!0,[],O._selectedValue),c(i)?i.forEach(function(e){0==O._selectedValue.filter(function(t){return o(e)&&o(t)&&e.toString()===t.toString()}).length&&O._selectedValue.push(e)}):i.forEach(function(e){0==O._selectedValue.filter(function(t){return o(e[l.valueField])&&o(t[l.valueField])&&e[l.valueField].toString()===t[l.valueField].toString()}).length&&O._selectedValue.push(e)});V(n)}else{if(O._selectedValue=e.extend(!0,[],O._selectedValue),l.group){for(var d in i)if(O._selectedValue[d]&&i[d]){var u=c(i[d]);i[d].forEach(function(e){O._selectedValue[d]=O._selectedValue[d].filter(function(t){return u?o(e)&&o(t)&&e.toString()!==t.toString():o(e[l.valueField])&&o(t[l.valueField])&&e[l.valueField].toString()!==t[l.valueField].toString()}),O._selectedValue[d].length<1&&delete O._selectedValue[d]})}}else c(i)?i.forEach(function(e){O._selectedValue=O._selectedValue.filter(function(t){return o(e)&&o(t)&&e.toString()!==t.toString()})}):i.forEach(function(e){O._selectedValue=O._selectedValue.filter(function(t){return o(e[l.valueField])&&o(t[l.valueField])&&e[l.valueField].toString()!==t[l.valueField].toString()})});j(n)}f({scrollTop:O._listScrollTop})}}})}function _(){T.find(".jq-select-group-title").change(function(t){t.stopPropagation();var i=O._filterData||l.data;if(i){var n=e(this).children('input[type="checkbox"]').prop("checked"),a=e(this).parents(".jq-select-group"),s=a.attr("data-name");if(i[s]){var r=e.extend(!0,[],i[s]);n?(O._selectedValue=e.extend(!0,[],O._selectedValue),c(i[s])?i[s].forEach(function(e){!O._selectedValue[s]||O._selectedValue[s].length<=0?(O._selectedValue[s]=[],O._selectedValue[s].push(e)):0==O._selectedValue[s].filter(function(t){return o(e)&&o(t)&&e.toString()===t.toString()}).length&&O._selectedValue[s].push(e)}):i[s].forEach(function(e){!O._selectedValue[s]||O._selectedValue[s].length<=0?(O._selectedValue[s]=[],O._selectedValue[s].push(e)):0==O._selectedValue[s].filter(function(t){return o(e[l.valueField])&&o(t[l.valueField])&&e[l.valueField].toString()===t[l.valueField].toString()}).length&&O._selectedValue[s].push(e)}),V(r)):(O._selectedValue=e.extend(!0,[],O._selectedValue),O._selectedValue[s]&&delete O._selectedValue[s],j(r)),f({scrollTop:O._listScrollTop})}}}),l.multi?T.find(".jq-select-item").change(function(t){if(t.stopPropagation(),!O._rendering&&l.data){var i,n=e(this).children('input[type="checkbox"]').prop("checked");if(l.group){var a=e(this).parents(".jq-select-group"),s=a.attr("data-name");if(!l.data[s])return;var o=e(this).attr("data-index");i=l.data[s][o],n?(O._selectedValue[s]||(O._selectedValue[s]=[]),O._selectedValue[s].push(i)):O._selectedValue[s]&&(O._selectedValue[s]=O._selectedValue[s].filter(function(e){return c(O._selectedValue[s])?e!==i:e[l.valueField]!==i[l.valueField]}))}else{var o=e(this).attr("data-index");i=l.data[o],n?O._selectedValue.push(i):O._selectedValue=O._selectedValue.filter(function(e){return c(O._selectedValue)?e!==i:e[l.valueField]!==i[l.valueField]})}n?V([i]):j([i]),f({scrollTop:O._listScrollTop})}}):T.find(".jq-select-item").mousedown(function(t){if(t.stopPropagation(),!O._rendering&&l.data){var i;if(l.group){var n=e(this).parents(".jq-select-group"),a=n.attr("data-name");if(!l.data[a])return;i=l.data[a][e(this).attr("data-index")],O._selectedValue={},O._selectedValue[a]=i}else i=l.data[e(this).attr("data-index")],O._selectedValue=i;T.find(".jq-select-item").removeClass("activated"),e(this).addClass("activated"),V(i),f({scrollTop:O._listScrollTop})}})}function m(){T.find(".jq-select-buttons-ok").mousedown(function(e){e.stopPropagation(),C(),p(),T.removeClass("activated"),l.onOK&&l.onOK(O._value)}),T.find(".jq-select-buttons-clear").mousedown(function(e){if(e.stopPropagation(),l.multi){var t=[];if(l.group)for(var i in O._selectedValue)t=t.concat(O._selectedValue[i]);else t=O._selectedValue;O._selectedValue=!l.group&&l.multi?[]:{},j(t)}else O._selectedValue=!l.group&&l.multi?[]:{},C();f({scrollTop:O._listScrollTop})}),T.find(".jq-select-buttons-close").mousedown(function(e){e.stopPropagation(),p(),T.removeClass("activated"),b()})}function x(){T.find(".jq-select-list").scroll(function(e){e.stopPropagation(),O._listScrollTop=e.target.scrollTop,f({scrollTop:e.target.scrollTop})})}function V(e){l.onSelect&&l.onSelect(e),C()}function j(e){l.onDeselect&&l.onDeselect(e),C()}function S(){if(l.data&&l.value)if(l.multi&&l.group){var i={},n=0;for(var a in l.data)if(l.value[a]){var s=[];l.data[a].forEach(function(t){l.value[a].forEach(function(i){var a,o;a=e.isPlainObject(t)?t[l.valueField].toString():t.toString(),o=e.isPlainObject(i)?i[l.valueField].toString():i.toString(),a&&o&&a===o&&(s.push(t),n++)})}),s.length>0&&(i[a]=s)}n>0?t.children(".jq-select-text").html(n+" selected"):t.children(".jq-select-text").html(l.noSelectText),O._selectedValue=e.extend(!0,{},i),O._value=e.extend(!0,{},i)}else if(l.multi&&!l.group){var i=[],n=0;l.data.forEach(function(t){l.value.forEach(function(a){var s,o;s=e.isPlainObject(t)?t[l.valueField].toString():t.toString(),o=e.isPlainObject(a)?a[l.valueField].toString():a.toString(),s&&o&&s===o&&(i.push(t),n++)})}),n>0?t.children(".jq-select-text").html(n+" selected"):t.children(".jq-select-text").html(l.noSelectText),O._selectedValue=e.extend(!0,[],i),O._value=e.extend(!0,[],i)}else if(!l.multi&&l.group){var i={},o="",c=!1;for(var a in l.data){if(c)break;l.value[a]&&l.data[a].forEach(function(t){if(!c){var n,s,r,d=l.value[a];return e.isPlainObject(t)?(n=t[l.valueField].toString(),s=t[l.displayField].toString()):(n=t.toString(),s=t.toString()),r=e.isPlainObject(d)?d[l.valueField].toString():d.toString(),n&&r&&n===r?(o=s,i[a]=t,void(c=!0)):void 0}})}i?t.children(".jq-select-text").html(o):t.children(".jq-select-text").html(l.noSelectText),O._selectedValue=e.extend(!0,{},i),O._value=e.extend(!0,{},i)}else{var i,o="",c=!1;l.data.forEach(function(t){if(!c){var n,a,s,r=l.value;return e.isPlainObject(t)?(n=t[l.valueField].toString(),a=t[l.displayField].toString()):(n=t.toString(),a=t.toString()),s=e.isPlainObject(r)?r[l.valueField].toString():r.toString(),n&&s&&n===s?(o=a,i=t,void(c=!0)):void 0}}),i?t.children(".jq-select-text").html(o):t.children(".jq-select-text").html(l.noSelectText),e.isPlainObject(i)?(O._selectedValue=e.extend(!0,{},i),O._value=e.extend(!0,{},i)):(O._selectedValue=i,O._value=i)}}function C(){if(l.data){if(l.multi&&l.group){var i=0;for(var n in O._selectedValue)i+=O._selectedValue[n].length;i>0?t.children(".jq-select-text").html(i+" selected"):t.children(".jq-select-text").html(l.noSelectText),JSON.stringify(O._value)!=JSON.stringify(O._selectedValue)&&(l.onChange&&l.onChange(O._selectedValue),O._value=e.extend(!0,{},O._selectedValue))}else if(l.multi&&!l.group){var i=O._selectedValue.length;i>0?t.children(".jq-select-text").html(i+" selected"):t.children(".jq-select-text").html(l.noSelectText),JSON.stringify(O._value)!=JSON.stringify(O._selectedValue)&&(l.onChange&&l.onChange(O._selectedValue),O._value=e.extend(!0,[],O._selectedValue))}else if(!l.multi&&l.group){var a;for(var n in O._selectedValue)a=O._selectedValue[n];t.children(".jq-select-text").html(e.isPlainObject(a)?a[l.displayField]?a[l.displayField]:l.noSelectText:a),JSON.stringify(O._value)!=JSON.stringify(O._selectedValue)&&(l.onChange&&l.onChange(O._selectedValue),O._value=e.extend(!0,{},O._selectedValue))}else e.isPlainObject(O._selectedValue)?(t.children(".jq-select-text").html(O._selectedValue[l.displayField]?O._selectedValue[l.displayField]:l.noSelectText),JSON.stringify(O._value)!==JSON.stringify(O._selectedValue)&&(l.onChange&&l.onChange(O._selectedValue),O._value=e.extend(!0,{},O._selectedValue))):(t.children(".jq-select-text").html(O._selectedValue),O._value!==O._selectedValue&&(l.onChange&&l.onChange(O._selectedValue),O._value=O._selectedValue));l.autoClose&&(p(),T.hasClass("activated")&&(T.removeClass("activated"),b()))}}function q(l){if(e(l.target).is(t)||e(l.target).parents(".jq-select").is(t)){if(l.stopPropagation(),p(),T.hasClass("activated"))return T.removeClass("activated"),void b();O._isLoading||(T.addClass("activated"),h(),g(),m(),x())}else 0!=e(l.target).parents(".jq-select-wrapper").length&&e(l.target).parents(".jq-select-wrapper").is(T)||(l.stopPropagation(),p(),T.hasClass("activated")&&(T.removeClass("activated"),b()))}function F(){d()}function b(){O._selectedValue=e.extend(!0,!l.group&&l.multi?[]:{},O._value),l.onClose&&l.onClose(O._value)}var T,y,O=this;return this._value=!l.group&&l.multi?[]:{},this._selectedValue=!l.group&&l.multi?[]:{},this._isLoading=!1,this._filterText="",this._filterData=null,this._listScrollTop=0,this._rendering=!1,this.init=function(){t.hasClass("jq-select-formated")||t.addClass("jq-select-formated").html('<span class="jq-select-text">'+l.noSelectText+"</span>").wrap(i),t.css("width",l.triggerWidth),t.find(".jq-select-icon").remove(),l.iconCls&&t.find(".jq-select-text").before('<i class="jq-select-icon '+l.iconCls+'"></i>'),S(),T=t.parent().toggleClass("jq-select-option-multi",l.multi).toggleClass("jq-select-option-group",l.group),e(document).on("mousedown",q),e(window).on("resize",F),t.off().on("updateOptions",function(){return l=e.extend(!0,{},e.fn.JQSelect.defaults,l),this}).on("loadingStart",function(){return r(!0),this}).on("loadingEnd",function(){return r(!1),this})},this.destroy=function(){p(),T.removeClass("activated"),e(document).off("mousedown",q),e(window).off("resize",F)},this.init(),{jQSelect:O,trigger:t,wrapper:T}}var l={list:[],add:function(e){this.list.push(e)},destroy:function(e){for(var t=this,l=0,i=t.list.length;l<i;l++)if(t.list[l].trigger.is(e)){t.list[l].jQSelect.destroy();break}t.list.splice(l,1)}},i='<div class="jq-select-wrapper"/>',n='<div class="jq-select-popup">\t\t\t<input type="text" class="jq-select-filter" placeholder="filter..."/>\t\t\t<label type="text" class="jq-select-select-all" placeholder="filter...">\t\t\t\t<input type="checkbox" class="jq-select-select-all-checkbox"/>\t\t\t\t<span class="jq-select-select-all-name"></span>\t\t\t</label>\t\t\t<div class="jq-select-list">\t\t\t\t<div class="jq-select-list-scroller"></div>\t\t\t</div>\t\t\t<div class="jq-select-buttons">\t\t\t\t<button type="button" class="jq-select-buttons-ok"></button>\t\t\t\t<button type="button" class="jq-select-buttons-clear"></button>\t\t\t\t<button type="button" class="jq-select-buttons-close"></button>\t\t\t</div>\t\t </div>',a='<div class="jq-select-group">\t\t\t<label class="jq-select-group-title">\t\t\t\t<input type="checkbox" class="jq-select-group-checkbox"/>\t\t\t\t<span class="jq-select-group-title-name"></span>\t\t\t</label>\t\t\t<div class="jq-select-group-children"></div>\t\t </div>',s='<label class="jq-select-item">\t\t\t<input type="checkbox" class="jq-select-item-checkbox"/>\t\t\t<i class="jq-select-item-icon"></i>\t\t\t<span class="jq-select-item-name"></span>\t\t </label>';e.fn.JQSelect=function(i){return this.each(function(){l.destroy(e(this)),l.add(new t(e(this),e.extend(!0,{},e.fn.JQSelect.defaults,i)))})},e.fn.JQSelect.defaults={multi:!1,group:!1,data:null,valueField:"value",displayField:"label",iconClsField:"iconCls",value:null,iconCls:"",noSelectText:"Please select ...",triggerWidth:200,popupWidth:200,listHeight:300,groupTitleHeight:30,itemHeight:30,hideFilter:!1,hideSelectAll:!1,selectAllText:"Select All",deselectAllText:"Deselect All",hideOKButton:!1,okButtonText:"OK",hideClearButton:!1,clearButtonText:"Clear",hideCloseButton:!1,closeButtonText:"Close",autoClose:!1,onSelect:null,onDeselect:null,onChange:null,onOK:null,onClose:null}}(jQuery);