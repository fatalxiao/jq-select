!function(e){function t(t,l){function c(t){return t=t||l.data,!!e.isArray(t)&&0==t.filter(function(t){return e.isPlainObject(t)}).length}function o(e){O.isLoading=e,e?k.addClass("loading"):k.removeClass("loading")}function r(){if(l.multi){var t=!0;l.group?k.find(".jq-select-group").each(function(){var l=!0;e(this).find(".jq-select-item-checkbox").each(function(){if(!e(this).prop("checked"))return l=!1,!1}),e(this).find(".jq-select-group-checkbox").prop("checked",l),t=t&&l}):k.find(".jq-select-item-checkbox").each(function(){if(!e(this).prop("checked"))return t=!1,!1}),k.find(".jq-select-select-all-name").html(t?l.deselectAllText:l.selectAllText),k.find(".jq-select-select-all-checkbox").prop("checked",t)}}function d(i){i=i||k.find(".jq-select-popup");var n=t.offset(),a=t.height(),s=0,c=O.filterData||l.data;if(l.group)for(var o in c)c[o].length>0&&(s+=30*(c[o].length+1));else c&&c.length>0&&(s=30*c.length);s=s>300?300:s,l.multi&&l.hideSelectAll===!1&&(s+=30),l.hideFilter===!1&&(s+=30),l.hideOKButton!==!1&&l.hideCloseButton!==!1||(s+=40),n.top+a+s-e(window).scrollTop()>e(window).height()?i.css("top",-s):i.css("top",a)}function u(){var t;if(l.group){t={};for(var i in l.data){var n=l.data[i].filter(function(t){return e.isPlainObject(t)?t&&t[l.displayField]&&t[l.displayField].toUpperCase().indexOf(O.filterText.toUpperCase())>-1:t&&t.toUpperCase().indexOf(O.filterText.toUpperCase())>-1});n.length>0&&(t[i]=n)}}else t=l.data.filter(function(t){return e.isPlainObject(t)?t&&t[l.displayField]&&t[l.displayField].toUpperCase().indexOf(O.filterText.toUpperCase())>-1:t&&t.toUpperCase().indexOf(O.filterText.toUpperCase())>-1});return t}function f(t){t=t||l.data;var i=F.find(".jq-select-list").html("");if(l.group){if(!e.isEmptyObject(t))for(var n in t){var o=e(a).attr("data-name",n);l.multi?O._value[n]&&t[n]&&O._value[n].length==t[n].length&&o.find(".jq-select-group-checkbox").prop("checked",!0):o.find(".jq-select-group-checkbox").remove(),o.find(".jq-select-group-title-name").html(n);var r=o.find(".jq-select-group-children");t[n].forEach(function(i){if(c(t[n])){var a=e(s);l.multi?O._value[n]&&1==O._value[n].filter(function(e){return e&&i&&e.toString()===i.toString()}).length&&a.find(".jq-select-item-checkbox").prop("checked",!0):(a.find(".jq-select-item-checkbox").remove(),O._value[n]&&O._value[n]&&i&&O._value[n].toString()===i.toString()&&a.addClass("activated")),a.find(".jq-select-item-name").html(i)}else{var a=e(s);l.multi?O._value[n]&&1==O._value[n].filter(function(e){return e[l.valueField]&&i[l.valueField]&&e[l.valueField].toString()===i[l.valueField].toString()}).length&&a.find(".jq-select-item-checkbox").prop("checked",!0):(a.find(".jq-select-item-checkbox").remove(),O._value[n]&&O._value[n][l.valueField]&&i[l.valueField]&&O._value[n][l.valueField].toString()===i[l.valueField].toString()&&a.addClass("activated")),i[l.iconClsField]?a.find(".jq-select-item-icon").addClass(i[l.iconClsField]):a.find(".jq-select-item-icon").remove(),a.find(".jq-select-item-name").html(i[l.displayField])}r.append(a)}),i.append(o)}}else e.isArray(t)&&t.forEach(function(n){var a;c(t)?(a=e(s),l.multi?1==O._value.filter(function(e){return e&&n&&e.toString()===n.toString()}).length&&a.find(".jq-select-item-checkbox").prop("checked",!0):(a.find(".jq-select-item-checkbox").remove(),O._value&&n&&O._value.toString()===n.toString()&&a.addClass("activated")),a.find(".jq-select-item-name").html(n)):(a=e(s),l.multi?1==O._value.filter(function(e){return e[l.valueField]&&n[l.valueField]&&e[l.valueField].toString()===n[l.valueField].toString()}).length&&a.find(".jq-select-item-checkbox").prop("checked",!0):(a.find(".jq-select-item-checkbox").remove(),O._value[l.valueField]&&n[l.valueField]&&O._value[l.valueField].toString()===n[l.valueField].toString()&&a.addClass("activated")),a.find(".jq-select-item-name").html(n[l.displayField])),i.append(a)})}function h(){F=e(n).css("min-width",l.triggerWidth),"auto"===l.popupWidth?F.css("width","auto"):isNaN(l.popupWidth)||F.width(l.popupWidth),l.hideFilter?F.find(".jq-select-filter").remove():F.find(".jq-select-filter").val(O.filterText),!l.multi||l.hideSelectAll?F.find(".jq-select-select-all").remove():F.find(".jq-select-select-all-name").html(l.selectAllText),O.filterText?(O.filterData=u(),f(O.filterData)):f();var t=F.find(".jq-select-buttons"),i=F.find(".jq-select-buttons-ok"),a=F.find(".jq-select-buttons-close");l.hideOKButton&&l.hideCloseButton?t.remove():(l.hideOKButton?(i.remove(),t.addClass("hide-ok-button")):i.html(l.okButtonText),l.hideCloseButton?(a.remove(),t.addClass("hide-cancel-button")):a.html(l.closeButtonText)),d(F),k.append(F)}function p(){k.children(".jq-select-popup").remove()}function v(){k.find(".jq-select-filter").bind("input",function(e){return O.filterText=e.target.value,O.filterText?(O.filterData=u(),f(O.filterData),void d()):(f(),void d())})}function g(){k.find(".jq-select-select-all").change(function(t){if(t.stopPropagation(),l.data){var i=[],n=e(this).children('input[type="checkbox"]'),a=n.prop("checked");if(k.find(".jq-select-select-all-name").html(a?l.deselectAllText:l.selectAllText),k.find(".jq-select-group-checkbox").prop("checked",a),k.find(".jq-select-item-checkbox").prop("checked",a),l.group){var s=e.extend(!0,{},l.data);for(var c in s)i=i.concat(s[c])}else i=e.extend(!0,[],l.data);a?j(i):q(i)}}),k.find(".jq-select-group-title").change(function(t){if(t.stopPropagation(),l.data){var i=e(this).children('input[type="checkbox"]').prop("checked"),n=e(this).parents(".jq-select-group"),a=n.attr("data-name");if(l.data[a]){n.find(".jq-select-item-checkbox").prop("checked",i);var s=e.extend(!0,[],l.data[a]);r(),i?j(s):q(s)}}}),l.multi?k.find(".jq-select-item").change(function(t){if(t.stopPropagation(),l.data){var i;if(l.group){var n=e(this).parents(".jq-select-group"),a=n.attr("data-name");if(!l.data[a])return;i=l.data[a][n.find(".jq-select-item").index(e(this))]}else{var s=e(this).parents(".jq-select-list");i=l.data[s.find(".jq-select-item").index(e(this))]}var c=e(this).children('input[type="checkbox"]').prop("checked");r(),c?j([i]):q([i])}}):k.find(".jq-select-item").mousedown(function(t){if(t.stopPropagation(),l.data){var i;if(l.group){var n=e(this).parents(".jq-select-group"),a=n.attr("data-name");if(!l.data[a])return;i=l.data[a][n.find(".jq-select-item").index(e(this))]}else{var s=e(this).parents(".jq-select-list");i=l.data[s.find(".jq-select-item").index(e(this))]}k.find(".jq-select-item").removeClass("activated"),e(this).addClass("activated"),j(i)}})}function m(){k.find(".jq-select-buttons-ok").mousedown(function(e){e.stopPropagation(),b(),p(),k.removeClass("activated"),l.onOK&&l.onOK()}),k.find(".jq-select-buttons-close").mousedown(function(e){e.stopPropagation(),p(),k.removeClass("activated"),l.onClose&&l.onClose()})}function j(e){l.onSelect&&l.onSelect(e),l.hideOKButton&&b()}function q(e){l.onDeselect&&l.onDeselect(e),l.hideOKButton&&b()}function x(){if(l.data&&l.value)if(l.multi&&l.group){var i={},n=0;for(var a in l.data)if(l.value[a]){var s=[];l.data[a].forEach(function(t){l.value[a].forEach(function(i){var a,c;a=e.isPlainObject(t)?t[l.valueField].toString():t.toString(),c=e.isPlainObject(i)?i[l.valueField].toString():i.toString(),a&&c&&a===c&&(s.push(t),n++)})}),s.length>0&&(i[a]=s)}n>0?t.children(".jq-select-text").html(n+" selected"):t.children(".jq-select-text").html(l.noSelectText),O._value=e.extend(!0,{},i)}else if(l.multi&&!l.group){var i=[],n=0;l.data.forEach(function(t){l.value.forEach(function(a){var s,c;s=e.isPlainObject(t)?t[l.valueField].toString():t.toString(),c=e.isPlainObject(a)?a[l.valueField].toString():a.toString(),s&&c&&s===c&&(i.push(t),n++)})}),n>0?t.children(".jq-select-text").html(n+" selected"):t.children(".jq-select-text").html(l.noSelectText),O._value=e.extend(!0,[],i)}else if(!l.multi&&l.group){var i={},c="",o=!1;for(var a in l.data){if(o)break;l.value[a]&&l.data[a].forEach(function(t){if(!o){var n,s,r,d=l.value[a];return e.isPlainObject(t)?(n=t[l.valueField].toString(),s=t[l.displayField].toString()):(n=t.toString(),s=t.toString()),r=e.isPlainObject(d)?d[l.valueField].toString():d.toString(),n&&r&&n===r?(c=s,i[a]=t,void(o=!0)):void 0}})}i?t.children(".jq-select-text").html(c):t.children(".jq-select-text").html(l.noSelectText),O._value=e.extend(!0,{},i)}else{var i,c="",o=!1;l.data.forEach(function(t){if(!o){var n,a,s,r=l.value;return e.isPlainObject(t)?(n=t[l.valueField].toString(),a=t[l.displayField].toString()):(n=t.toString(),a=t.toString()),s=e.isPlainObject(r)?r[l.valueField].toString():r.toString(),n&&s&&n===s?(c=a,i=t,void(o=!0)):void 0}}),i?t.children(".jq-select-text").html(c):t.children(".jq-select-text").html(l.noSelectText),e.isPlainObject(i)?O._value=e.extend(!0,{},i):O._value=i}}function b(){if(l.data){if(l.multi&&l.group){var i=k.find(".jq-select-item-checkbox:checked"),n={},a=i.length;i.each(function(){var t=e(this).parents(".jq-select-group"),i=t.attr("data-name");l.data[i]&&(n[i]||(n[i]=[]),n[i].push(l.data[i][t.find(".jq-select-item-checkbox").index(e(this))]))}),a>0?t.children(".jq-select-text").html(a+" selected"):t.children(".jq-select-text").html(l.noSelectText),JSON.stringify(O._value)!=JSON.stringify(n)&&(l.onChange&&l.onChange(n),O._value=e.extend(!0,{},n))}else if(l.multi&&!l.group){var i=k.find(".jq-select-item-checkbox:checked"),n=[],a=i.length;i.each(function(){var t=e(this).parents(".jq-select-list");n.push(l.data[t.find(".jq-select-item-checkbox").index(e(this))])}),a>0?t.children(".jq-select-text").html(a+" selected"):t.children(".jq-select-text").html(l.noSelectText),JSON.stringify(O._value)!=JSON.stringify(n)&&(l.onChange&&l.onChange(n),O._value=e.extend(!0,[],n))}else if(!l.multi&&l.group){var s=k.find(".jq-select-item.activated"),n={},c=s.parents(".jq-select-group"),o=c.attr("data-name");if(!l.data[o])return;n[o]||(n[o]=[]);var r=l.data[o][c.find(".jq-select-item").index(s)];n[o]=r,t.children(".jq-select-text").html(e.isPlainObject(r)?r[l.displayField]:r),JSON.stringify(O._value)!=JSON.stringify(n)&&(l.onChange&&l.onChange(n),O._value=e.extend(!0,{},n))}else{var s=k.find(".jq-select-item.activated"),d=s.parents(".jq-select-list"),n=l.data[d.find(".jq-select-item").index(s)];e.isPlainObject(n)?(t.children(".jq-select-text").html(n[l.displayField]),JSON.stringify(O._value)!==JSON.stringify(n)&&(l.onChange&&l.onChange(n),O._value=e.extend(!0,{},n))):(t.children(".jq-select-text").html(n),O._value!==n&&(l.onChange&&l.onChange(n),O._value=n))}l.autoClose&&(p(),k.hasClass("activated")&&(k.removeClass("activated"),l.onClose&&l.onClose()))}}function C(i){if(e(i.target).is(t)||e(i.target).parents(".jq-select").is(t)){if(i.stopPropagation(),p(),k.hasClass("activated"))return k.removeClass("activated"),void(l.onClose&&l.onClose());O.isLoading||(k.addClass("activated"),h(),v(),g(),m())}else 0!=e(i.target).parents(".jq-select-wrapper").length&&e(i.target).parents(".jq-select-wrapper").is(k)||(i.stopPropagation(),p(),k.hasClass("activated")&&(k.removeClass("activated"),l.onClose&&l.onClose()))}function S(){d()}var k,F,O=this;return this._value=!l.group&&l.multi?[]:{},this.isLoading=!1,this.filterText="",this.filterData=null,this.init=function(){t.hasClass("jq-select-formated")||t.addClass("jq-select-formated").html('<span class="jq-select-text">'+l.noSelectText+"</span>").wrap(i),t.css("width",l.triggerWidth),t.find(".jq-select-icon").remove(),l.iconCls&&t.find(".jq-select-text").before('<i class="jq-select-icon '+l.iconCls+'"></i>'),x(),k=t.parent().toggleClass("jq-select-option-multi",l.multi).toggleClass("jq-select-option-group",l.group),e(document).on("mousedown",C),e(window).on("resize",S),t.off().on("updateOptions",function(){return l=e.extend(!0,{},e.fn.JQSelect.defaults,l),this}).on("loadingStart",function(){return o(!0),this}).on("loadingEnd",function(){return o(!1),this})},this.destroy=function(){p(),k.removeClass("activated"),e(document).off("mousedown",C),e(window).off("resize",S)},this.init(),{jQSelect:O,trigger:t,wrapper:k}}var l={list:[],add:function(e){this.list.push(e)},destroy:function(e){for(var t=this,l=0,i=t.list.length;l<i;l++)if(t.list[l].trigger.is(e)){t.list[l].jQSelect.destroy();break}t.list.splice(l,1)}},i='<div class="jq-select-wrapper"/>',n='<div class="jq-select-popup">\t\t\t<input type="text" class="jq-select-filter" placeholder="filter..."/>\t\t\t<label type="text" class="jq-select-select-all" placeholder="filter...">\t\t\t\t<input type="checkbox" class="jq-select-select-all-checkbox"/>\t\t\t\t<span class="jq-select-select-all-name"></span>\t\t\t</label>\t\t\t<div class="jq-select-list"></div>\t\t\t<div class="jq-select-buttons">\t\t\t\t<button type="button" class="jq-select-buttons-ok"></button>\t\t\t\t<button type="button" class="jq-select-buttons-close"></button>\t\t\t</div>\t\t </div>',a='<div class="jq-select-group">\t\t\t<label class="jq-select-group-title">\t\t\t\t<input type="checkbox" class="jq-select-group-checkbox"/>\t\t\t\t<span class="jq-select-group-title-name"></span>\t\t\t</label>\t\t\t<div class="jq-select-group-children"></div>\t\t </div>',s='<label class="jq-select-item">\t\t\t<input type="checkbox" class="jq-select-item-checkbox"/>\t\t\t<i class="jq-select-item-icon"></i>\t\t\t<span class="jq-select-item-name"></span>\t\t </label>';e.fn.JQSelect=function(i){return this.each(function(){l.destroy(e(this)),l.add(new t(e(this),e.extend(!0,{},e.fn.JQSelect.defaults,i)))})},e.fn.JQSelect.defaults={multi:!1,group:!1,data:null,valueField:"value",displayField:"label",iconClsField:"iconCls",value:null,iconCls:"",noSelectText:"Please select ...",triggerWidth:200,popupWidth:200,hideFilter:!1,hideSelectAll:!1,selectAllText:"Select All",deselectAllText:"Deselect All",hideOKButton:!1,okButtonText:"OK",hideCloseButton:!1,closeButtonText:"Close",autoClose:!1,onSelect:null,onDeselect:null,onChange:null,onOK:null,onClose:null}}(jQuery);