!function(e){function t(t,l){function c(e){return null!==e&&void 0!==e}function o(t){return t=t||l.data,!!e.isArray(t)&&0==t.filter(function(t){return e.isPlainObject(t)}).length}function d(e){y._isLoading=e,e?T.addClass("loading"):T.removeClass("loading")}function r(i){i=i||T.find(".jq-select-popup");var a=t.offset(),s=t.height(),n=0,c=y._filterData||l.data;if(l.group)for(var o in c)c[o].length>0&&(n+=30*(c[o].length+1));else c&&c.length>0&&(n=30*c.length);n=n>300?300:n,l.multi&&l.hideSelectAll===!1&&(n+=30),l.hideFilter===!1&&(n+=30),l.hideOKButton!==!1&&l.hideCloseButton!==!1&&l.hideClearButton!==!1||(n+=40),a.top+s+n-e(window).scrollTop()>e(window).height()?i.css("top",-n):i.css("top",s)}function u(){var t;if(l.group){t={};for(var i in l.data){var a=l.data[i].filter(function(t){return e.isPlainObject(t)?c(t)&&c(t[l.displayField])&&t[l.displayField].toUpperCase().indexOf(y._filterText.toUpperCase())>-1:c(t)&&t.toUpperCase().indexOf(y._filterText.toUpperCase())>-1});a.length>0&&(t[i]=a)}}else t=l.data.filter(function(t){return e.isPlainObject(t)?c(t)&&c(t[l.displayField])&&t[l.displayField].toUpperCase().indexOf(y._filterText.toUpperCase())>-1:c(t)&&t.toUpperCase().indexOf(y._filterText.toUpperCase())>-1});return t}function p(t){var i=t&&t.data||l.data,a=t&&t.scrollTop||0,d=T.find(".jq-select-list-scroller").html(""),r=0;if(l.group){if(e.isEmptyObject(i))return;var u=!0;for(var p in i){if(r>a+l.listHeight)break;if(r<=a+l.listHeight&&r+l.groupTitleHeight+l.itemHeight*i[p].length>=a){var h=e(s).attr("data-name",p);u&&(d.append('<div style="height:'+r+'px"></div>'),u=!1),r+=l.groupTitleHeight,l.multi?y._selectedValue[p]&&i[p]&&y._selectedValue[p].length==i[p].length&&h.find(".jq-select-group-checkbox").prop("checked",!0):h.find(".jq-select-group-checkbox").remove(),h.find(".jq-select-group-title-name").html(p);for(var f=h.find(".jq-select-group-children"),g=!0,m=0,_=i[p].length;m<_;m++)if(void 0!==i[p][m]){var j=i[p][m];if(r+l.itemHeight>=a&&r<=a+l.listHeight){var x=e(n).attr("data-index",m);g&&(f.append('<div style="height:'+l.itemHeight*m+'px"></div>'),g=!1),o(i[p])?(l.multi?y._selectedValue[p]&&1==y._selectedValue[p].filter(function(e){return c(e)&&c(j)&&e.toString()===j.toString()}).length&&x.find(".jq-select-item-checkbox").prop("checked",!0):(x.find(".jq-select-item-checkbox").remove(),c(y._selectedValue[p])&&c(j)&&y._selectedValue[p].toString()===j.toString()&&x.addClass("activated")),x.find(".jq-select-item-name").html(j)):(l.multi?y._selectedValue[p]&&1==y._selectedValue[p].filter(function(e){return c(e[l.valueField])&&c(j[l.valueField])&&e[l.valueField].toString()===j[l.valueField].toString()}).length&&x.find(".jq-select-item-checkbox").prop("checked",!0):(x.find(".jq-select-item-checkbox").remove(),c(y._selectedValue[p])&&c(y._selectedValue[p][l.valueField])&&c(j)&&j[l.valueField]&&y._selectedValue[p][l.valueField].toString()===j[l.valueField].toString()&&x.addClass("activated")),j[l.iconClsField]?x.find(".jq-select-item-icon").addClass(j[l.iconClsField]):x.find(".jq-select-item-icon").remove(),x.find(".jq-select-item-name").html(j[l.displayField])),f.append(x)}r+=l.itemHeight}d.append(h)}else r+=l.groupTitleHeight+l.itemHeight*i[p].length}var q=0;for(var p in i)q+=l.groupTitleHeight+l.itemHeight*i[p].length;d.height(q)}else{if(!e.isArray(i))return;for(var g=!0,m=0,_=i.length;m<_;m++)if(void 0!==i[m]){if(r>a+l.listHeight)break;if(r+l.itemHeight>=a&&r<=a+l.listHeight){var j=i[m],x=e(n).attr("data-index",m);g&&(d.append('<div style="height:'+r+'px"></div>'),g=!1),o(i)?(l.multi?1==y._selectedValue.filter(function(e){return c(e)&&c(j)&&e.toString()===j.toString()}).length&&x.find(".jq-select-item-checkbox").prop("checked",!0):(x.find(".jq-select-item-checkbox").remove(),c(y._selectedValue)&&c(j)&&y._selectedValue.toString()===j.toString()&&x.addClass("activated")),x.find(".jq-select-item-name").html(j)):(l.multi?1==y._selectedValue.filter(function(e){return c(e[l.valueField])&&c(j[l.valueField])&&e[l.valueField].toString()===j[l.valueField].toString()}).length&&x.find(".jq-select-item-checkbox").prop("checked",!0):(x.find(".jq-select-item-checkbox").remove(),c(y._selectedValue[l.valueField])&&c(j[l.valueField])&&y._selectedValue[l.valueField].toString()===j[l.valueField].toString()&&x.addClass("activated")),x.find(".jq-select-item-name").html(j[l.displayField])),d.append(x)}r+=l.itemHeight}d.height(i.length*l.itemHeight)}v()}function h(){y._listScrollTop=0,F=e(a).css("min-width",l.triggerWidth),"auto"===l.popupWidth?F.css("width","auto"):isNaN(l.popupWidth)||F.width(l.popupWidth),l.hideFilter?F.find(".jq-select-filter").remove():F.find(".jq-select-filter").val(y._filterText),!l.multi||l.hideSelectAll?F.find(".jq-select-select-all").remove():F.find(".jq-select-select-all-name").html(l.selectAllText);var t=F.find(".jq-select-buttons"),i=F.find(".jq-select-buttons-ok"),s=F.find(".jq-select-buttons-clear"),n=F.find(".jq-select-buttons-close"),c=0;l.hideOKButton?i.remove():(i.html(l.okButtonText),c++),l.hideClearButton?s.remove():(s.html(l.clearButtonText),c++),l.hideCloseButton?n.remove():(n.html(l.closeButtonText),c++),0===c?t.remove():t.addClass("buttons-"+c),r(F),T.append(F),y._filterText?(y._filterData=u(),p({data:y._filterData})):p()}function f(){T.children(".jq-select-popup").remove()}function g(){T.find(".jq-select-filter").bind("input",function(e){return y._filterText=e.target.value,y._filterText?(y._filterData=u(),p({data:y._filterData}),void r()):(p(),void r())})}function v(){T.find(".jq-select-select-all").change(function(t){if(t.stopPropagation(),l.data&&l.multi){var i=[],a=e(this).children('input[type="checkbox"]'),s=a.prop("checked");if(T.find(".jq-select-select-all-name").html(s?l.deselectAllText:l.selectAllText),l.group){var n=e.extend(!0,{},l.data);for(var c in n)i=i.concat(n[c])}else i=e.extend(!0,[],l.data);s?(l.group?y._selectedValue=e.extend(!0,{},l.data):y._selectedValue=e.extend(!0,[],l.data),j(i)):(l.group?y._selectedValue={}:y._selectedValue=[],x(i)),p({scrollTop:y._listScrollTop})}}),T.find(".jq-select-group-title").change(function(t){if(t.stopPropagation(),l.data){var i=e(this).children('input[type="checkbox"]').prop("checked"),a=e(this).parents(".jq-select-group"),s=a.attr("data-name");if(l.data[s]){var n=e.extend(!0,[],l.data[s]);if(i){var c=e.extend(!0,[],l.data[s]);y._selectedValue[s]=c,j(n)}else y._selectedValue[s]&&delete y._selectedValue[s],x(n);p({scrollTop:y._listScrollTop})}}}),l.multi?T.find(".jq-select-item").change(function(t){if(t.stopPropagation(),l.data){var i,a=e(this).children('input[type="checkbox"]').prop("checked");if(l.group){var s=e(this).parents(".jq-select-group"),n=s.attr("data-name");if(!l.data[n])return;var c=e(this).attr("data-index");i=l.data[n][c],a?(y._selectedValue[n]||(y._selectedValue[n]=[]),y._selectedValue[n].push(i)):y._selectedValue[n]&&(y._selectedValue[n]=y._selectedValue[n].filter(function(e){return o(y._selectedValue[n])?e!==i:e[l.valueField]!==i[l.valueField]}))}else{var c=e(this).attr("data-index");i=l.data[c],a?y._selectedValue.push(i):y._selectedValue=y._selectedValue.filter(function(e){return o(y._selectedValue)?e!==i:e[l.valueField]!==i[l.valueField]})}a?j([i]):x([i]),p({scrollTop:y._listScrollTop})}}):T.find(".jq-select-item").mousedown(function(t){if(t.stopPropagation(),l.data){var i;if(l.group){var a=e(this).parents(".jq-select-group"),s=a.attr("data-name");if(!l.data[s])return;i=l.data[s][e(this).attr("data-index")],y._selectedValue={},y._selectedValue[s]=i}else i=l.data[e(this).attr("data-index")],y._selectedValue=i;T.find(".jq-select-item").removeClass("activated"),e(this).addClass("activated"),j(i),p({scrollTop:y._listScrollTop})}})}function m(){T.find(".jq-select-buttons-ok").mousedown(function(e){e.stopPropagation(),S(),f(),T.removeClass("activated"),l.onOK&&l.onOK()}),T.find(".jq-select-buttons-clear").mousedown(function(e){if(e.stopPropagation(),l.multi){var t=[];if(l.group)for(var i in y._selectedValue)t=t.concat(y._selectedValue[i]);else t=y._selectedValue;y._selectedValue=!l.group&&l.multi?[]:{},x(t)}else y._selectedValue=!l.group&&l.multi?[]:{},S();p({scrollTop:y._listScrollTop})}),T.find(".jq-select-buttons-close").mousedown(function(e){e.stopPropagation(),f(),T.removeClass("activated"),C()})}function _(){T.find(".jq-select-list").scroll(function(e){e.stopPropagation(),y._listScrollTop=e.target.scrollTop,p({scrollTop:e.target.scrollTop})})}function j(e){l.onSelect&&l.onSelect(e),S()}function x(e){l.onDeselect&&l.onDeselect(e),S()}function q(){if(l.data&&l.value)if(l.multi&&l.group){var i={},a=0;for(var s in l.data)if(l.value[s]){var n=[];l.data[s].forEach(function(t){l.value[s].forEach(function(i){var s,c;s=e.isPlainObject(t)?t[l.valueField].toString():t.toString(),c=e.isPlainObject(i)?i[l.valueField].toString():i.toString(),s&&c&&s===c&&(n.push(t),a++)})}),n.length>0&&(i[s]=n)}a>0?t.children(".jq-select-text").html(a+" selected"):t.children(".jq-select-text").html(l.noSelectText),y._selectedValue=e.extend(!0,{},i),y._value=e.extend(!0,{},i)}else if(l.multi&&!l.group){var i=[],a=0;l.data.forEach(function(t){l.value.forEach(function(s){var n,c;n=e.isPlainObject(t)?t[l.valueField].toString():t.toString(),c=e.isPlainObject(s)?s[l.valueField].toString():s.toString(),n&&c&&n===c&&(i.push(t),a++)})}),a>0?t.children(".jq-select-text").html(a+" selected"):t.children(".jq-select-text").html(l.noSelectText),y._selectedValue=e.extend(!0,[],i),y._value=e.extend(!0,[],i)}else if(!l.multi&&l.group){var i={},c="",o=!1;for(var s in l.data){if(o)break;l.value[s]&&l.data[s].forEach(function(t){if(!o){var a,n,d,r=l.value[s];return e.isPlainObject(t)?(a=t[l.valueField].toString(),n=t[l.displayField].toString()):(a=t.toString(),n=t.toString()),d=e.isPlainObject(r)?r[l.valueField].toString():r.toString(),a&&d&&a===d?(c=n,i[s]=t,void(o=!0)):void 0}})}i?t.children(".jq-select-text").html(c):t.children(".jq-select-text").html(l.noSelectText),y._selectedValue=e.extend(!0,{},i),y._value=e.extend(!0,{},i)}else{var i,c="",o=!1;l.data.forEach(function(t){if(!o){var a,s,n,d=l.value;return e.isPlainObject(t)?(a=t[l.valueField].toString(),s=t[l.displayField].toString()):(a=t.toString(),s=t.toString()),n=e.isPlainObject(d)?d[l.valueField].toString():d.toString(),a&&n&&a===n?(c=s,i=t,void(o=!0)):void 0}}),i?t.children(".jq-select-text").html(c):t.children(".jq-select-text").html(l.noSelectText),e.isPlainObject(i)?(y._selectedValue=e.extend(!0,{},i),y._value=e.extend(!0,{},i)):(y._selectedValue=i,y._value=i)}}function S(){if(l.data){if(l.multi&&l.group){var i=0;for(var a in y._selectedValue)i+=y._selectedValue[a].length;i>0?t.children(".jq-select-text").html(i+" selected"):t.children(".jq-select-text").html(l.noSelectText),JSON.stringify(y._value)!=JSON.stringify(y._selectedValue)&&(l.onChange&&l.onChange(y._selectedValue),y._value=e.extend(!0,{},y._selectedValue))}else if(l.multi&&!l.group){var i=y._selectedValue.length;i>0?t.children(".jq-select-text").html(i+" selected"):t.children(".jq-select-text").html(l.noSelectText),JSON.stringify(y._value)!=JSON.stringify(y._selectedValue)&&(l.onChange&&l.onChange(y._selectedValue),y._value=e.extend(!0,[],y._selectedValue))}else if(!l.multi&&l.group){var s;for(var a in y._selectedValue)s=y._selectedValue[a];t.children(".jq-select-text").html(e.isPlainObject(s)?s[l.displayField]?s[l.displayField]:l.noSelectText:s),JSON.stringify(y._value)!=JSON.stringify(y._selectedValue)&&(l.onChange&&l.onChange(y._selectedValue),y._value=e.extend(!0,{},y._selectedValue))}else e.isPlainObject(y._selectedValue)?(t.children(".jq-select-text").html(y._selectedValue[l.displayField]?y._selectedValue[l.displayField]:l.noSelectText),JSON.stringify(y._value)!==JSON.stringify(y._selectedValue)&&(l.onChange&&l.onChange(y._selectedValue),y._value=e.extend(!0,{},y._selectedValue))):(t.children(".jq-select-text").html(y._selectedValue),y._value!==y._selectedValue&&(l.onChange&&l.onChange(y._selectedValue),y._value=y._selectedValue));p({scrollTop:y._listScrollTop}),l.autoClose&&(f(),T.hasClass("activated")&&(T.removeClass("activated"),C()))}}function V(l){if(e(l.target).is(t)||e(l.target).parents(".jq-select").is(t)){if(l.stopPropagation(),f(),T.hasClass("activated"))return T.removeClass("activated"),void C();y._isLoading||(T.addClass("activated"),h(),g(),m(),_())}else 0!=e(l.target).parents(".jq-select-wrapper").length&&e(l.target).parents(".jq-select-wrapper").is(T)||(l.stopPropagation(),f(),T.hasClass("activated")&&(T.removeClass("activated"),C()))}function b(){r()}function C(){y._selectedValue=e.extend(!0,!l.group&&l.multi?[]:{},y._value),l.onClose&&l.onClose()}var T,F,y=this;return this._value=!l.group&&l.multi?[]:{},this._selectedValue=!l.group&&l.multi?[]:{},this._isLoading=!1,this._filterText="",this._filterData=null,this._listScrollTop=0,this.init=function(){t.hasClass("jq-select-formated")||t.addClass("jq-select-formated").html('<span class="jq-select-text">'+l.noSelectText+"</span>").wrap(i),t.css("width",l.triggerWidth),t.find(".jq-select-icon").remove(),l.iconCls&&t.find(".jq-select-text").before('<i class="jq-select-icon '+l.iconCls+'"></i>'),q(),T=t.parent().toggleClass("jq-select-option-multi",l.multi).toggleClass("jq-select-option-group",l.group),e(document).on("mousedown",V),e(window).on("resize",b),t.off().on("updateOptions",function(){return l=e.extend(!0,{},e.fn.JQSelect.defaults,l),this}).on("loadingStart",function(){return d(!0),this}).on("loadingEnd",function(){return d(!1),this})},this.destroy=function(){f(),T.removeClass("activated"),e(document).off("mousedown",V),e(window).off("resize",b)},this.init(),{jQSelect:y,trigger:t,wrapper:T}}var l={list:[],add:function(e){this.list.push(e)},destroy:function(e){for(var t=this,l=0,i=t.list.length;l<i;l++)if(t.list[l].trigger.is(e)){t.list[l].jQSelect.destroy();break}t.list.splice(l,1)}},i='<div class="jq-select-wrapper"/>',a='<div class="jq-select-popup">\t\t\t<input type="text" class="jq-select-filter" placeholder="filter..."/>\t\t\t<label type="text" class="jq-select-select-all" placeholder="filter...">\t\t\t\t<input type="checkbox" class="jq-select-select-all-checkbox"/>\t\t\t\t<span class="jq-select-select-all-name"></span>\t\t\t</label>\t\t\t<div class="jq-select-list">\t\t\t\t<div class="jq-select-list-scroller"></div>\t\t\t</div>\t\t\t<div class="jq-select-buttons">\t\t\t\t<button type="button" class="jq-select-buttons-ok"></button>\t\t\t\t<button type="button" class="jq-select-buttons-clear"></button>\t\t\t\t<button type="button" class="jq-select-buttons-close"></button>\t\t\t</div>\t\t </div>',s='<div class="jq-select-group">\t\t\t<label class="jq-select-group-title">\t\t\t\t<input type="checkbox" class="jq-select-group-checkbox"/>\t\t\t\t<span class="jq-select-group-title-name"></span>\t\t\t</label>\t\t\t<div class="jq-select-group-children"></div>\t\t </div>',n='<label class="jq-select-item">\t\t\t<input type="checkbox" class="jq-select-item-checkbox"/>\t\t\t<i class="jq-select-item-icon"></i>\t\t\t<span class="jq-select-item-name"></span>\t\t </label>';e.fn.JQSelect=function(i){return this.each(function(){l.destroy(e(this)),l.add(new t(e(this),e.extend(!0,{},e.fn.JQSelect.defaults,i)))})},e.fn.JQSelect.defaults={multi:!1,group:!1,data:null,valueField:"value",displayField:"label",iconClsField:"iconCls",value:null,iconCls:"",noSelectText:"Please select ...",triggerWidth:200,popupWidth:200,listHeight:300,groupTitleHeight:30,itemHeight:30,hideFilter:!1,hideSelectAll:!1,selectAllText:"Select All",deselectAllText:"Deselect All",hideOKButton:!1,okButtonText:"OK",hideClearButton:!1,clearButtonText:"Clear",hideCloseButton:!1,closeButtonText:"Close",autoClose:!1,onSelect:null,onDeselect:null,onChange:null,onOK:null,onClose:null}}(jQuery);