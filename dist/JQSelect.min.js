"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(e,t){var i=this;return this.originEl=e,this.options=t,this.wrapperEl=null,this.triggerEl=null,this.popupEl=null,this.data=null,this.visible=!1,this.value=[],this.filterText="",this.filteredData=null,this.init(),{jQSelect:i,originEl:e}}var i={list:[],add:function(e){this.list.push(e)},destroy:function(e){for(var t=this,i=0,l=t.list.length;i<l;i++)if(t.list[i].originEl.is(e)){t.list[i].jQSelect.destroy();break}t.list.splice(i,1)}},l='<div class="jq-select-wrapper"/>',s='<button type="button" class="jq-select-trigger"></button>',n=function(e){return'<div class="jq-select-popup">\n\n                     <div class="jq-select-filter-wrapper">\n                         <input type="text" \n                                class="jq-select-filter" \n                                placeholder="'+e.filterPlaceholder+'"/>\n                         <i class="jq-select-filter-icon '+e.filterIconCls+'"></i>\n                     </div>\n                     \n                     <label type="text" \n                            class="jq-select-select-all">\n                         <input type="checkbox" \n                                class="jq-select-checkbox jq-select-select-all-checkbox '+e.checkboxIconCls+'"/>\n                         <span class="jq-select-select-all-name">'+e.selectAllText+'</span>\n                     </label>\n                     \n                     <div class="jq-select-list">\n                         <div class="jq-select-list-scroller"></div>\n                     </div>\n                     \n                 </div>'},r=function(e){return'<label class="jq-select-item">\n                     <input type="checkbox" \n                            class="jq-select-checkbox jq-select-item-checkbox"/>\n                     <i class="jq-select-item-icon"></i>\n                     <span class="jq-select-item-name"></span>\n                 </label>'},o=function(e,t,i){return void 0!==i&&(e=e>i?i:e),void 0!==t&&(e=e<t?t:e),e},a=function(t,i,l,s){if(!i)return!0;for(;t;){if(e(t).is(l))return s;if(e(t).is(i))return!s;t=t.parentNode}return!1},c=function(e){var t=0;return e.map(function(e){return{rawValue:e,jqSelectIndex:t++}})},p=function(e,t,i){var l=e.length,s=Math.floor(t/i.itemHeight),n=s+Math.ceil(i.listHeight/i.itemHeight);return s-=i.renderBuffer,n+=i.renderBuffer,{start:o(s,0,l-1),stop:o(n,0,l-1)}},h=function(e,t,i){return"object"==("undefined"==typeof e?"undefined":_typeof(e))?e[t]||e[i]:e},d=function(e,t,i){return"object"==("undefined"==typeof e?"undefined":_typeof(e))?e[i]||e[t]:e},u=function(e,t,i,l){if(!e||e.length<1||!t)return!1;var s=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(s=(o=a.next()).done);s=!0){var c=o.value;if(h(c,i,l)===h(t,i,l))return!0}}catch(p){n=!0,r=p}finally{try{!s&&a["return"]&&a["return"]()}finally{if(n)throw r}}return!1},f=function(e,t,i,l){return t?e.filter(function(e){return d(e.rawValue,i,l).toString().toUpperCase().includes(t.toString().toUpperCase())}):e};t.prototype.initData=function(){var t=this;if(this.options.data)return void(this.filteredData=this.data=c(this.options.data));if(!this.originEl)return void(this.filteredData=this.data=null);var i=this.originEl.children("option");if(i&&i.length>0){var l=[],s=0;i.each(function(){var i;l.push({rawValue:(i={},_defineProperty(i,t.options.valueField,e(t).val()),_defineProperty(i,t.options.displayField,e(t).html()),i),jqSelectIndex:s++})}),this.filteredData=this.data=l}},t.prototype.initValue=function(){if(!this.options.data||this.options.data.length<1||!this.options.value||this.options.value.length<1)this.value=[];else{var e=[],t=!0,i=!1,l=void 0;try{for(var s,n=this.options.value[Symbol.iterator]();!(t=(s=n.next()).done);t=!0){var r=s.value,o=this.options,a=o.valueField,c=o.displayField,p=h(r,a,c),d=!0,u=!1,f=void 0;try{for(var v,g=this.options.data[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var m=v.value;if(h(m,a,c)===p){e.push(m);break}}}catch(y){u=!0,f=y}finally{try{!d&&g["return"]&&g["return"]()}finally{if(u)throw f}}}}catch(y){i=!0,l=y}finally{try{!t&&n["return"]&&n["return"]()}finally{if(i)throw l}}this.value=e}this.updateValue()},t.prototype.updateValue=function(){var e=this,t=this.value.length;if(t>0){this.triggerEl.html(this.value.length+" selected");var i=this.value.map(function(t){return h(t,e.options.valueField,e.options.displayField)}).join(",");this.originEl.html('<option value="'+i+'" selected="selected"></option>')}else this.triggerEl.html(this.options.noSelectText),this.originEl.html("")},t.prototype.renderList=function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.popupEl){var l=this,s=this.popupEl.find(".jq-select-list-scroller");if(!this.filteredData||this.filteredData.length<1)return void s.html("");for(var n=this.options.itemHeight,o=p(this.filteredData,i,this.options),a=o.start,c=o.stop,f=this.options,v=f.valueField,g=f.displayField,m=[],y=function(i){var l=t.filteredData[i].rawValue,o=t.filteredData[i].jqSelectIndex,a=s.children(".jq-select-item[jq-select-index="+o+"]");if(a[0])return a.css({transform:"translate(0, "+i*n+"px)"}),"continue";a=e(r(t.options)).attr("jq-select-index",o).css({height:n,lineHeight:n+"px",transform:"translate(0, "+i*n+"px)"});var c=l[t.options.iconClsField];c?a.children(".jq-select-item-icon").addClass(c):a.children(".jq-select-item-icon").remove(),t.options.multi?u(t.value,l,v,g)&&(a.children(".jq-select-item-checkbox").prop("checked",!0),a.addClass("activated")):a.children(".jq-select-checkbox").remove(),a.children(".jq-select-item-name").html(d(l,v,g)),a.mousedown(function(){if(!t.value||t.value.length<1||!l)t.value=[l],a.addClass("activated");else if(u(t.value,l,v,g)){for(var e=0,i=t.value.length;e<i;e++)if(h(t.value[e],v,g)===h(l,v,g)){t.value.splice(e,1);break}a.removeClass("activated")}else t.value.push(l),a.addClass("activated");var s=t.value.length===t.filteredData.length;t.popupEl.children(".jq-select-select-all").toggleClass("activated",s),t.popupEl.find(".jq-select-select-all-checkbox").prop("checked",s),t.updateValue()}),m.push(a)},j=a;j<=c;j++){y(j)}s.children().each(function(){for(var t=parseInt(e(this).attr("jq-select-index")),i=l.filteredData.slice(a,c+1),s=!1,n=0,r=i.length;n<r;n++)if(t===i[n].jqSelectIndex){s=!0;break}s||e(this).remove()}),s.append(m)}},t.prototype.showPopup=function(){var t=this;if(this.triggerEl){this.popupEl?this.popupEl.removeClass("hidden"):(this.popupEl=e(n(this.options)).appendTo("body"),this.popupEl.children(".jq-select-list").on("scroll",this.scrollHandler.bind(this)));var i=this.triggerEl.offset();this.popupEl.css({transform:"translate("+i.left+"px, "+(i.top+this.triggerEl.height())+"px)"}).find(".jq-select-list-scroller").css({height:this.filteredData.length*this.options.itemHeight}),this.popupEl.children(".jq-select-list")[0].scrollTop=0,this.wrapperEl.addClass("activated");var l=this.popupEl.children(".jq-select-filter-wrapper");this.options.enableFilter?l.children(".jq-select-filter").on("input",function(e){t.filterText=e.target.value,t.filteredData=f(t.data,t.filterText,t.options.valueField,t.options.displayField),t.popupEl.children(".jq-select-list")[0].scrollTop=0,t.popupEl.find(".jq-select-list-scroller").css({height:t.filteredData.length*t.options.itemHeight}),t.renderList()}):l.remove();var s=this.popupEl.children(".jq-select-select-all");if(this.options.enableSelectAll){var r=this.value.length===this.data.length,o=s.children(".jq-select-select-all-checkbox");s.toggleClass("activated",r),o.prop("checked",r),s.mousedown(function(){var e=!o.is(":checked");t.value=e?t.data.map(function(e){return e.rawValue}):[],t.popupEl.children(".jq-select-select-all").toggleClass("activated",e),t.popupEl.find(".jq-select-item").toggleClass("activated",e),t.popupEl.find(".jq-select-item-checkbox").prop("checked",e),t.updateValue()})}else s.remove();this.renderList()}},t.prototype.hidePopup=function(){this.popupEl&&this.popupEl.addClass("hidden"),this.wrapperEl.removeClass("activated"),this.visible=!1},t.prototype.mousedownHandler=function(e){return this.visible=a(e.target,this.triggerEl,this.popupEl,this.visible),this.visible?void(this.wrapperEl.hasClass("activated")||this.showPopup()):void this.hidePopup()},t.prototype.scrollHandler=function(e){this.renderList(e.target.scrollTop)},t.prototype.resizeHandler=function(){},t.prototype.init=function(){var t=this.originEl.hasClass("jq-select-formated");t||this.originEl.addClass("jq-select-formated").hide().wrap(l),this.wrapperEl=this.originEl.parent().toggleClass("multi",this.options.multi),t?this.triggerEl=this.wrapperEl.children(".jq-select-trigger"):(this.triggerEl=e(s),this.wrapperEl.prepend(this.triggerEl)),this.initData(),this.initValue(),this.triggerEl.find(".jq-select-icon").remove(),this.options.iconCls&&this.triggerEl.find(".jq-select-text").before('<i class="jq-select-icon '+this.options.iconCls+'"></i>'),e(document).on("mousedown",this.mousedownHandler.bind(this)),e(window).on("resize",this.resizeHandler.bind(this))},t.prototype.destroy=function(){this.triggerEl.remove(),this.originEl.removeClass("jq-select-formated").unwrap(),this.popupEl&&this.popupEl.remove(),this.popupEl=null},e.fn.JQSelect=function(l){return this.each(function(){i.destroy(e(this)),i.add(new t(e(this),e.extend(!0,{},e.fn.JQSelect.defaults,l)))})},e.fn.JQSelect.defaults={multi:!1,data:null,valueField:"value",displayField:"label",iconClsField:"iconCls",value:null,iconCls:"",noSelectText:"Please select ...",listHeight:300,itemHeight:30,renderBuffer:3,enableFilter:!1,filterPlaceholder:"filter ...",enableSelectAll:!1,selectAllText:"Select All",itemActivatedCls:"activated"}}(jQuery);